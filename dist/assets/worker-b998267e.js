(function(){"use strict";function N(e){return new Promise(t=>{setTimeout(t,e)})}function L(e){try{return JSON.parse(e)}catch(t){const[n,a]=k(e,t);return n}}function k(e,t){const n=u[e[0]];if(!n)throw console.error(`no parser registered for ${JSON.stringify(e[0])}:`,{s:e}),t;return n(e,t)}const u={};function f(e){return e.trimLeft()}u[" "]=P,u["\r"]=P,u[`
`]=P,u["	"]=P;function P(e,t){return e=f(e),k(e,t)}u["["]=Z;function Z(e,t){e=e.substr(1);const n=[];for(e=f(e);e.length>0;){if(e[0]==="]"){e=e.substr(1);break}const a=k(e,t);n.push(a[0]),e=a[1],e=f(e),e[0]===","&&(e=e.substring(1),e=f(e))}return[n,e]}for(const e of"0123456789.-".slice())u[e]=T;function T(e){for(let t=0;t<e.length;t++){const n=e[t];if(u[n]===T)continue;const a=e.substring(0,t);return e=e.substring(t),[_(a),e]}return[_(e),""]}function _(e){if(e==="-")return-0;const t=+e;return Number.isNaN(t)?e:t}u['"']=C;function C(e){for(let t=1;t<e.length;t++){const n=e[t];if(n==="\\"){t++;continue}if(n==='"'){const a=e.substring(0,t+1);return e=e.substring(t+1),[JSON.parse(a),e]}}return[JSON.parse(e+'"'),""]}u["{"]=z;function z(e,t){e=e.substr(1);const n={};for(e=f(e);e.length>0;){if(e[0]==="}"){e=e.substr(1);break}const a=k(e,t),o=a[0];if(e=a[1],e=f(e),e[0]!==":"){n[o]=void 0;break}if(e=e.substr(1),e=f(e),e.length===0){n[o]=void 0;break}const l=k(e,t);n[o]=l[0],e=l[1],e=f(e),e[0]===","&&(e=e.substr(1),e=f(e))}return[n,e]}u.t=W;function W(e,t){return I(e,"true",!0,t)}u.f=$;function $(e,t){return I(e,"false",!1,t)}u.n=D;function D(e,t){return I(e,"null",null,t)}function I(e,t,n,a){for(let o=t.length;o>=1;o--)if(e.startsWith(t.slice(0,o)))return[n,e.slice(o)];{const o=JSON.stringify(e.slice(0,t.length));throw console.error(`unknown token starting with ${o}:`,{s:e}),a}}let i=[],x=!1;const H=50,J=50,M=5e3,A=1e3,F=async(e,t,n=!1)=>{let a=0;const o=async y=>(await l(0,y,0,i),n||(x=!0),t&&postMessage({finishedProcessing:!0,totalRows:i.length}),i),l=async(y,g,b,d,O)=>{const v=Object.keys(g);for(let S=0;S<v.length;S++){!t&&!n&&(a++===100&&postMessage({page:d,end:!1}),a>=100&&await N(1));const p=v[S],c=g[p]===null?"null":g[p],m=Array.isArray(c),h=typeof c=="object"?m?"array":"object":"primitive";d.push({level:b,type:h,key:p,value:h==="primitive"?c+"":void 0,primitiveType:h==="primitive"?g[p]===null?"null":typeof c:void 0,isParentArray:O,length:typeof c=="string"?c.length:0}),typeof c=="object"&&(await l(y++,c,b+1,d,m),d.push({level:b,type:m?"close-brace":"close-bracket",key:p,value:h==="primitive"?c:void 0,length:typeof c=="string"?c.length:0}))}};return o(e)};onmessage=async e=>{var n,a,o,l,y,g,b,d,O,v,S,p,c,m,h,G,j;let t=((n=e.data)==null?void 0:n.pageSize)||(x?J:H);if((a=e.data)!=null&&a.parcial){const s=(o=e.data)==null?void 0:o.file.slice(0,1e3);try{const r=L(new FileReaderSync().readAsText(s));F(r,!1,!0).then(w=>{postMessage({pageParcial:i})})}catch(r){console.log(r),postMessage({error:!0})}}if((l=e.data)!=null&&l.file){await N(100);try{i=[],F(JSON.parse(new FileReaderSync().readAsText((y=e.data)==null?void 0:y.file)),(g=e.data)==null?void 0:g.turbo).then(s=>{s.length<t&&postMessage({page:i,end:!1,reset:!0})})}catch{postMessage({error:!0})}}if((b=e.data)!=null&&b.reset&&postMessage({page:i.slice(0,J),reset:!0}),(d=e.data)!=null&&d.offset&&i){let s=i.slice((O=e.data)==null?void 0:O.offset,((v=e.data)==null?void 0:v.offset)+t)||[],r=0;for(;r++<30&&s.length<t&&!x;)await N(100),s=i.slice((S=e.data)==null?void 0:S.offset,((p=e.data)==null?void 0:p.offset)+t)||[];const w=x&&((c=e.data)==null?void 0:c.offset)+t>=i.length;postMessage({page:s,end:w})}if((m=e.data)!=null&&m.search){const s=i==null?void 0:i.findIndex(r=>{var w,R,E;return(E=(R=(r==null?void 0:r.key)+((r==null?void 0:r.type)==="primitive"?(r==null?void 0:r.value)+"":"")).includes)==null?void 0:E.call(R,(w=e.data)==null?void 0:w.search)});if(s>-1&&s>((h=e.data)==null?void 0:h.loadedLength)){let r=M+s-((G=e.data)==null?void 0:G.loadedLength);if(Math.floor(r/M)+1>30){postMessage({searchResultIndex:A,searchScopeMode:!0,pageSearch:i.slice(Math.max(s-A,0),s+A)});return}let R=0;for(;r>0;){const E=((j=e.data)==null?void 0:j.loadedLength)+M*R++;postMessage({pageSearch:i.slice(E,E+M)}),r-=M,await N(1)}postMessage({searchResultIndex:s})}else postMessage({searchResultIndex:s})}}})();
